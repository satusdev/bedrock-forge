pipeline {
    agent any

    environment {
        // Set these in Jenkins or pass as parameters
        KUMA_NOTIFY_URL = credentials('KUMA_NOTIFY_URL') // e.g. http://kuma-server:3001/api/push/<monitor-id>
        KUMA_PUSH_TOKEN = credentials('KUMA_PUSH_TOKEN') // if needed
    }

    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }
        stage('Build') {
            steps {
                sh 'echo "Build step (composer install, lint, etc.)"'
            }
        }
        stage('Test') {
            steps {
                sh 'echo "Test step (unit/integration tests)"'
            }
        }
        stage('Deploy') {
            steps {
                sh 'echo "Deploy step (call scripts/deploy/deploy.sh or similar)"'
            }
        }
        stage('Notify Kuma') {
            steps {
                sh '''
                if [ -n "$KUMA_NOTIFY_URL" ]; then
                  curl -X POST "$KUMA_NOTIFY_URL" -H "Authorization: $KUMA_PUSH_TOKEN" || echo "Kuma notify failed"
                else
                  echo "KUMA_NOTIFY_URL not set, skipping Kuma notification"
                fi
                '''
            }
        }
    }

    post {
        success {
            echo 'Pipeline completed successfully.'
        }
        failure {
            echo 'Pipeline failed.'
        }
    }
}
