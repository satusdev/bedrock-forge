#!/bin/bash

# Bedrock Forge CLI Update Script

set -e

# Colors
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
BLUE='\033[0;34m'
NC='\033[0m'

INSTALL_DIR="$HOME/.bedrock-forge"
VENV_DIR="$INSTALL_DIR/venv"

print_info() {
    echo -e "${BLUE}ℹ️  $1${NC}"
}

print_success() {
    echo -e "${GREEN}✅ $1${NC}"
}

print_warning() {
    echo -e "${YELLOW}⚠️  $1${NC}"
}

print_error() {
    echo -e "${RED}❌ $1${NC}"
}

echo -e "${BLUE}🔄 Bedrock Forge CLI Updater${NC}"
echo

# Check if installed
if [[ ! -d "$INSTALL_DIR" ]]; then
    print_error "Bedrock Forge CLI is not installed."
    echo "Run the installation script first:"
    echo "curl -sSL https://raw.githubusercontent.com/bedrock-forge/bedrock-forge/main/install.sh | bash"
    exit 1
fi

# Update from git
cd "$INSTALL_DIR"
print_info "Pulling latest changes from repository..."
git pull origin main

# Update Python dependencies
print_info "Updating Python dependencies..."
source "$VENV_DIR/bin/activate"
pip install -e .

# Verify update
if python -m forge --version >/dev/null 2>&1; then
    version=$(python -m forge --version 2>/dev/null || echo "unknown")
    print_success "Bedrock Forge CLI updated successfully!"
    print_info "New version: $version"
else
    print_error "Update verification failed"
    exit 1
fi

echo
print_success "Update completed! 🎉"